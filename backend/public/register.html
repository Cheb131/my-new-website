<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Đăng ký</title>

  <!-- Nếu dự án bạn đang dùng style.css thì bật 2 dòng này -->
  <!-- <link rel="stylesheet" href="CSS/style.css" /> -->
  <!-- <link rel="stylesheet" href="CSS/responsive.css" /> -->

  <style>
    :root { --primary: #b30000; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f6f6f6;
      color:#111;
    }
    .wrap{
      max-width: 520px;
      margin: 40px auto;
      padding: 0 16px;
    }
    .card{
      background:#fff;
      border-radius: 14px;
      box-shadow: 0 6px 24px rgba(0,0,0,.08);
      overflow:hidden;
    }
    .card-head{
      padding: 16px 18px;
      border-top: 4px solid var(--primary);
      border-bottom: 1px solid #eee;
    }
    .title{
      margin:0;
      font-size: 18px;
      font-weight: 800;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: .4px;
    }
    .subtitle{
      margin: 6px 0 0;
      font-size: 13px;
      color:#666;
    }
    form{
      padding: 18px;
      display: grid;
      gap: 12px;
    }
    label{
      font-size: 13px;
      font-weight: 700;
      color:#333;
      display:block;
      margin-bottom: 6px;
    }
    .field input{
      width:100%;
      height: 42px;
      padding: 0 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      outline: none;
      font-size: 14px;
    }
    .field input:focus{
      border-color: rgba(179,0,0,.55);
      box-shadow: 0 0 0 4px rgba(179,0,0,.08);
    }
    .hint{
      font-size: 12px;
      color:#777;
      margin-top: 6px;
      line-height: 1.35;
    }
    .error{
      display:none;
      background:#fff1f1;
      border: 1px solid #ffd2d2;
      color:#b42318;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.35;
    }
    .success{
      display:none;
      background:#ecfdf3;
      border: 1px solid #abefc6;
      color:#067647;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.35;
    }
    .actions{
      display:flex;
      gap:10px;
      margin-top: 4px;
    }
    .btn{
      height: 42px;
      border-radius: 10px;
      border: 0;
      padding: 0 14px;
      font-weight: 800;
      cursor:pointer;
      font-size: 14px;
    }
    .btn-primary{
      background: var(--primary);
      color:#fff;
      flex: 1;
    }
    .btn-secondary{
      background:#f0f0f0;
      color:#111;
      text-decoration: none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      flex: 1;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){
      .wrap{ margin: 18px auto; }
      .row{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="card-head">
        <h1 class="title">Đăng ký</h1>
        <p class="subtitle">Tài khoản sẽ được lưu trong database SQLite (backend).</p>
      </div>

      <form id="registerForm" novalidate>
        <div class="error" id="formError"></div>
        <div class="success" id="formSuccess"></div>

        <div class="field">
          <label for="username">Tên đăng nhập</label>
          <input id="username" name="username" type="text" placeholder="vd: nguyenvanA" autocomplete="username" required />
          <div class="hint">Từ 4–20 ký tự. Chỉ nên dùng chữ, số, dấu gạch dưới (_).</div>
        </div>

        <div class="row">
          <div class="field">
            <label for="password">Mật khẩu</label>
            <input id="password" name="password" type="password" placeholder="••••••••" autocomplete="new-password" required />
            <div class="hint">Tối thiểu 6 ký tự.</div>
          </div>

          <div class="field">
            <label for="password2">Nhập lại mật khẩu</label>
            <input id="password2" name="password2" type="password" placeholder="••••••••" autocomplete="new-password" required />
          </div>
        </div>

        <div class="field">
          <label for="email">Gmail</label>
          <input id="email" name="email" type="email" placeholder="vd: abc@gmail.com" autocomplete="email" required />
        </div>

        <div class="field">
          <label for="phone">Số điện thoại</label>
          <input id="phone" name="phone" type="tel" placeholder="vd: 0901234567" autocomplete="tel" required />
          <div class="hint">Chỉ nhập số (10–11 số).</div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" type="submit">Tạo tài khoản</button>
          <a class="btn btn-secondary" href="index.html">Về trang chủ</a>
        </div>
      </form>
    </div>
  </div>

<script>
  const $ = (sel) => document.querySelector(sel);
  const form = $("#postForm");
  const errBox = $("#formError");
  const okBox = $("#formSuccess");

  // default date = today
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0");
  const dd = String(today.getDate()).padStart(2, "0");
  $("#date").value = `${yyyy}-${mm}-${dd}`;

  function showError(msg) {
    okBox.style.display = "none";
    okBox.textContent = "";
    errBox.textContent = msg;
    errBox.style.display = "block";
  }
  function showSuccess(msg) {
    errBox.style.display = "none";
    errBox.textContent = "";
    okBox.textContent = msg;
    okBox.style.display = "block";
  }

  function formatDateISOToVN(iso) {
    if (!iso) return "";
    const [y, m, d] = iso.split("-");
    return `${d}/${m}/${y}`;
  }

  function buildPreview() {
    const title = $("#title").value.trim();
    const dateIso = $("#date").value;
    const category = $("#category").value;
    const excerpt = $("#excerpt").value.trim();
    const image = $("#image").value.trim() || "Assets/images/sample.png";

    $("#previewImg").src = image;
    $("#previewTitle").textContent = title || "(Chưa có tiêu đề)";
    $("#previewMeta").textContent =
      `${formatDateISOToVN(dateIso)}${category ? " • " + category : ""}`;
    $("#previewExcerpt").textContent = excerpt || "—";
    $("#previewBox").style.display = "flex";
  }

  $("#previewBtn").addEventListener("click", buildPreview);

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const token = window.API?.getToken?.();
    if (!token) return showError("Bạn cần đăng nhập (admin/manager) để đăng bài.");

    const title = $("#title").value.trim();
    const dateIso = $("#date").value;
    const category = $("#category").value;
    const image = $("#image").value.trim() || "Assets/images/sample.png";
    const author = $("#author").value.trim() || "Ban biên tập";
    const excerpt = $("#excerpt").value.trim();
    const content = $("#content").value.trim();

    if (!title || title.length < 5) return showError("Tiêu đề tối thiểu 5 ký tự.");
    if (!dateIso) return showError("Vui lòng chọn ngày đăng.");
    if (!category) return showError("Vui lòng chọn danh mục.");
    if (!content || content.length < 20) return showError("Nội dung tối thiểu 20 ký tự.");

    try {
      const payload = {
        title,
        content,
        excerpt,
        image,
        category,
        author,
        date: formatDateISOToVN(dateIso),
      };

      const created = await window.API.apiCreateArticle(payload);

      showSuccess("Đăng bài thành công! Đang mở bài viết…");
      buildPreview();

      setTimeout(() => {
        window.location.href = `article.html?id=${encodeURIComponent(created.id)}`;
      }, 500);
    } catch (err) {
      console.error(err);
      showError(err?.message || "Đăng bài thất bại.");
    }
  });
</script>


</body>
</html>
